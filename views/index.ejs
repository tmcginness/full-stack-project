<!DOCTYPE html>
<html lang="en">

<head>

    <%- include('./partials/head'); %>
        <title>Portfolio</title>
</head>

<body class="">
    <div class="container-md">
        <!-- Updating Portfolio Balance -->
        <% let portfolioBalance = 0 %>
            <% for (let i = 0; i < all.length; i++) {
            if(all[i].transactionType === 'BUY') { 
              portfolioBalance += Number(all[i].value) }
                else if(all[i].transactionType === 'SELL') {
                  portfolioBalance -= Number(all[i].value) }
                } %>
                <!-- Done -->
                <!-- Display It -->
                <div class="mb-5 mt-3 text-center">
                    <h1 class="display-4 balance">Portfolio Balance:
                        <br/> $
                        <span id="balance">
                            <%=portfolioBalance%>
                        </span>
                    </h1>


                    <a class="btn mt-3 btn-dark" href="/new">Add a new transaction!</a>
                </div>
                <!-- Portfolio Balance Chart -->
                <iframe style="background: #FFFFFF;border: none;border-radius: 2px;box-shadow: 0 2px 10px 0 rgba(70, 76, 79, .2);" width="100%"
                    height="480" src="https://charts.mongodb.com/charts-project-0-djibx/embed/charts?id=620c0a48-2989-4cbb-8dba-68907695f839&maxDataAge=60&theme=light&autoRefresh=true"></iframe>

                <!-- Find Unique Coins -->
                <div class=" row ">
                    <h2 class="p-5 text-center ">Your Coin Balances</h2>
                    <% for (let i = 0; i <transactions.length; i++){%>
                        <% let currentCoin = transactions[i] %>

                            <div class="text-center col-md-4 col-sm-6 p-3 bg-light border ">
                                <div class="coinTitle ">
                                    <a class="text-dark " href="/coin/<%=transactions[i]%>">
                                        <%= currentCoin %>
                                    </a>
                                </div>
                                <div class="p-3">
                                    <a class="bg-light" href="/coin/<%=transactions[i]%>">
                                        <img class="coinImg" src="https://cryptoicon-api.vercel.app/api/icon/<%=transactions[i].toLowerCase();%>" alt="<%=transactions[i]%> Logo">
                                    </a>
                                </div>


                                <!-- Find Coin Amounts -->
                                <% let coinBalance = 0 %>
                                    <% for (let i = 0; i < all.length; i++) { 
                                if(all[i].coin === currentCoin && all[i].transactionType === 'BUY'){ 
                                   coinBalance += Number(all[i].amount) 
                                } else if (all[i].coin === currentCoin && all[i].transactionType === 'SELL'){
                                    coinBalance -= Number(all[i].amount) 
                                }} %>
                                        <div class="bg-light coinBalance">
                                            Balance:
                                            <%=coinBalance %>
                                        </div>
                            </div>
                            <% } %>
                </div>
                <!-- Recent (5) Transactions Table -->
                <div class="mt-5 row">
                    <h2 class="pb-3 text-center">Your Recent Transactions</h2>
                    <div class="table-responsive">
                        <table style="box-shadow: 0 2px 10px 0 rgba(70, 76, 79, .2);" class="table table-light table-striped text-center w-100">
                            <thead>
                                <tr>
                                    <th scope="col">Coin</th>
                                    <th scope="col">Amount</th>
                                    <th class="date" scope="col">Date</th>
                                    <th scope="col">Value</th>
                                    <th scope="col">Type</th>
                                    <th scope="col"></th>
                                    <th scope="col"></th>
                                    <th scope="col"></th>
                                </tr>
                            </thead>
                            <% for (let i = 0; i < 5; i++){%>

                                <tr class="border">
                                    <td>

                                        <%=all[i].coin; %>

                                    </td>
                                    <td>
                                        <%=all[i].amount; %>
                                    </td>
                                    <td class="date">
                                        <%=all[i].date; %>
                                    </td>
                                    <td>
                                        $
                                        <%=all[i].value; %>
                                    </td>
                                    <td>
                                        <%=all[i].transactionType; %>
                                    </td>
                                    <td>
                                        <a class="w-100 btn btn-dark" href="<%=all[i].id; %>">VIEW</a>
                                    </td>
                                    <td class="phone">
                                        <a class="w-100 btn btn-dark" href="/<%=all[i].id%>/edit">EDIT</a>
                                    </td>
                                    <td class="phone">
                                        <form action="/<%=all[i].id; %>?_method=DELETE" method="POST">
                                            <input class=" w-100 btn btn-dark" type="submit" value="DELETE">

                                        </form>

                                    </td>
                                </tr>


                                <% } %>
                        </table>
                    </div>
                </div>
                <div class="text-center">
                    <a class="m-5 btn btn-dark" href="/all">View All Transactions</a>
                </div>

    </div>




</body>


</html>